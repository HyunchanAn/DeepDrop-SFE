# 개발 로그 (Development Log)

##### 2026-01-14 #####

### 1. 물리 엔진 디버깅 및 개선
- 문제 해결: 접촉각이 특정 입력값에서 수치 불안정성 및 로직 공백으로 인해 지속적으로 0.0도로 반환되던 문제 해결.
- 수정 사항: 
    - calculate_contact_angle 함수에서 미세 각도(0.1도)의 불연속 구간 제거.
    - brentq 솔버 탐색 범위 개선(1e-7 ~ 179.9) 및 물리적 타당성 검사(부피 > 구 용량 등) 추가.
    - 새로운 회귀 테스트(tests/test_diagnostics.py)로 로직 검증 완료.
- 결과: 보고된 테스트 케이스(V=3.0uL, D=9.1mm)에 대해 정확한 접촉각(약 2.3도) 계산 성공.

### 2. AI 엔진 강화
- 문제 해결: 세그멘테이션 과정에서 가장자리 배경 잡음을 물방울로 오인하던 현상 해결.
- 수정 사항: 
    - predict_mask에 경계 패널티 로직을 추가하여 비물방울 아티팩트 필터링.
    - 라이브러리 사용을 지원하기 위해 MobileSAM 모델 경로 처리 로직 개선.

### 3. UI/UX 업데이트 (Streamlit 앱)
- 수정 사항: 시각화 중 앱 충돌을 유발하던 cv2.rectangle의 TypeError 해결.
- 신규 기능: 
    - 3단계에 고급 진단 정보(Advanced Diagnostics) 확장 패널을 추가하여 내부 수치(r, V, v_low, v_high)를 투명하게 공개.
    - 새로운 deepdrop_sfe 라이브러리 구조를 사용하도록 UI 코드 업데이트.

### 4. 라이브러리 리팩토링 (주요 아키텍처 변경)
- 목표: 소스 코드를 재사용 가능한 파이썬 패키지로 전환.
- 조치 사항:
    - 소스 디렉터리명 변경: src -> deepdrop_sfe.
    - 표준 패키징 설정을 위한 pyproject.toml 추가.
    - __init__.py를 통해 핵심 클래스(DropletPhysics, AIContactAngleAnalyzer, PerspectiveCorrector) 노출.
    - demo/app.py 및 모든 테스트 파일이 deepdrop_sfe 패키지를 import 하도록 수정.
    - examples/use_core_lib.py에 사용 예시 추가 및 README.md 업데이트.

### 5. Git 및 브랜치 관리
- 생성된 브랜치: 
    - stable/physics-fix: 검증된 물리 및 UI 수정 사항 포함 (Docker 파일 제거됨).
    - feature/lib-refactoring: 전체 라이브러리 구조 개편 사항 포함.
- 정리: 임시 디버그 스크립트 및 검증 로그 파일 삭제.
