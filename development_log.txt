# 개발 로그 (Development Log)

##### 2026-02-15 #####

### 1. 사선 촬영(Oblique Shooting) 지원 및 원근 보정 기능 구현
- 작업 내용:
    - Homography 기반 원근 보정 로직 구현 (PerspectiveCorrector).
    - 타원형 동전을 정원으로 변환하여 Top-down View 생성.
    - `ai_engine.py`: 사선 촬영 시 찌그러진 타원 동전 감지 로직 강화 (Aspect Ratio 허용 범위 확대).

### 2. 정밀 분석을 위한 UI/UX 개선
- 신규 기능:
    - **Canvas Drawing Mode**: 모바일 환경을 고려하여 슬라이더 대신 화면 위에 직접 박스를 그리는 인터페이스 도입 (`streamlit-drawable-canvas`).
    - **Dynamic Droplet Visualization**: 측정된 접촉각을 직관적으로 이해할 수 있도록 파란색 물방울 단면 프로필을 실시간으로 시각화 (Matplotlib).
    - **SFE Analysis Guide**: 물리적 정합성을 위해 Manual Selection을 통한 보정 가이드라인 추가.

### 3. 버그 수정 및 최적화
- 수정 사항:
    - `st_canvas`의 Key가 파일명 변경에만 반응하던 버그 수정 (참조 물체/모드 변경 시 강제 리프레시).
    - Streamlit Deprecation Warning (`use_column_width` -> `use_container_width`) 해결.
    - 리포트의 수치적 불일치(Volume vs Diameter) 문제를 해결하기 위해 기본 부피를 100uL로 조정 및 수동 보정 절차 확립.

##### 2026-02-10 #####

### 1. 최종 브랜치 통합 및 메인 브랜치 병합
- 작업 내용: 
    - `feature/sam2-integration` 브랜치의 모든 최신 작업물을 `main` 브랜치로 병합 완료.
    - SAM 2.1 통합, RTX 5080 최적화, 라이브러리 리팩토링 사항이 공식적으로 반영됨.
- 배포 준비: 
    - Streamlit Cloud 배포를 위해 `requirements.txt` 점검 및 `opencv-python-headless` 설정 확인.
    - `demo/app.py`의 모바일/PC 대응 레이아웃 및 자동 모델 다운로드 로직 검증.
- 비고: 향후 Streamlit Cloud 배포 시 Large 모델의 메모리 점유율(약 3GB+)에 따른 인스턴스 사양 주의 필요.


##### 2026-02-08 #####

### 1. SAM 2.1 대규모 통합 및 실하드웨어 최적화
- 작업 목적: RTX 5080 (16GB VRAM)의 강력한 사양을 활용하여 이미지 분석 정밀도와 속도를 극대화.
- 주요 성과:
    - AI 엔진을 MobileSAM에서 SAM 2.1 (facebook/sam2.1-hiera-large)로 전면 교체.
    - RTX 5080 환경에서 추론 속도 29.5ms 달성 (기존 대비 비약적 향상).
    - `build_sam2_hf` 연동을 통한 자동 모델 관리 체계 구축.
    - 이미지 크기 언팩 관련 런타임 버그 수정 및 안정화.
- 환경 구성: Python 3.14 호환성 해결을 위한 `Pillow 11+` 및 최신 SAM2 패키지 설치 완료.
- 브랜치: `feature/sam2-integration`에서 모든 작업 통합 및 검증 완료.
- 결과: 보고된 테스트 케이스(V=3.0uL, D=9.1mm)에 대해 정확한 접촉각(약 2.3도) 계산 성공.

### 2. AI 엔진 강화
- 문제 해결: 세그멘테이션 과정에서 가장자리 배경 잡음을 물방울로 오인하던 현상 해결.
- 수정 사항: 
    - predict_mask에 경계 패널티 로직을 추가하여 비물방울 아티팩트 필터링.
    - 라이브러리 사용을 지원하기 위해 MobileSAM 모델 경로 처리 로직 개선.

### 3. UI/UX 업데이트 (Streamlit 앱)
- 수정 사항: 시각화 중 앱 충돌을 유발하던 cv2.rectangle의 TypeError 해결.
- 신규 기능: 
    - 3단계에 고급 진단 정보(Advanced Diagnostics) 확장 패널을 추가하여 내부 수치(r, V, v_low, v_high)를 투명하게 공개.
    - 새로운 deepdrop_sfe 라이브러리 구조를 사용하도록 UI 코드 업데이트.

### 4. 라이브러리 리팩토링 (주요 아키텍처 변경)
- 목표: 소스 코드를 재사용 가능한 파이썬 패키지로 전환.
- 조치 사항:
    - 소스 디렉터리명 변경: src -> deepdrop_sfe.
    - 표준 패키징 설정을 위한 pyproject.toml 추가.
    - __init__.py를 통해 핵심 클래스(DropletPhysics, AIContactAngleAnalyzer, PerspectiveCorrector) 노출.
    - demo/app.py 및 모든 테스트 파일이 deepdrop_sfe 패키지를 import 하도록 수정.
    - examples/use_core_lib.py에 사용 예시 추가 및 README.md 업데이트.

### 5. Git 및 브랜치 관리
- 생성된 브랜치: 
    - stable/physics-fix: 검증된 물리 및 UI 수정 사항 포함 (Docker 파일 제거됨).
    - feature/lib-refactoring: 전체 라이브러리 구조 개편 사항 포함.
- 정리: 임시 디버그 스크립트 및 검증 로그 파일 삭제.

##### 2026-02-08 #####

### 1. 하드웨어 사양 확인 및 문서화
- 조치 사항:
    - 시스템 사양 확인: AMD Ryzen 9 9900X, NVIDIA GeForce RTX 5080 (16GB), 64GB RAM.
    - gemini.md 생성: 하드웨어 사양 기록 및 향후 문서 작성 언어(한글) 원칙 수립.

### 2. 하드웨어 가속 환경 최적화
- 목표: 고사양 GPU(RTX 5080) 활용을 위한 딥러닝 환경 구축.
- 조치 사항:
    - Python 3.14 환경 하에서 CUDA 12.x를 지원하는 최신 PyTorch(2.7.0.dev) 및 관련 의존성(OpenCV, MobileSAM 등) 설치 완료.
    - ai_engine.py 최적화: GPU 모델명/VRAM 로깅 추가 및 torch.backends.cudnn.benchmark 활성화로 연산 효율 증대.

### 4. 하드웨어 진단 도구 도입
- 신규 기능:
    - hardware_diagnostics.py 추가: CPU, GPU, Python 환경 결합 상태를 즉시 확인할 수 있는 통합 진단 스크립트 제공.
- 결과: RTX 5080을 통한 하드웨어 가속이 정상 작동함을 검증 완료.

##### 2026-02-08 (추가 작업) #####

### 1. 전면적인 시스템 검증 및 RTX 5080 최적화
- 작업 내용:
    - RTX 5080 (Blackwell 아키텍처) 지원을 위해 PyTorch 나이틀리 빌드(2.11.0.dev+cu128) 및 CUDA 12.8 환경 구축.
    - `verify_hardware_acceleration.py`를 통한 SAM 2.1 추론 성능 검증 (1024x1024 이미지 기준 124.8ms).
    - 핵심 라이브러리(`deepdrop_sfe`)의 API 정상 작동 확인 (3.0uL 테스트 케이스 접촉각 2.30도 산출).
    - `pytest`를 통한 물리 엔진 및 원근 보정 모듈 단위 테스트 8건 통과.
- 환경 규정 준수:
    - 항후 모든 아티팩트 및 진행 상황 보고는 `gemini.md`의 페르소나 규정에 따라 한글로 수행하도록 설정.
    - 프로젝트 내 주요 의존성 및 테스트 도구(`pytest`, `sam2`) 설치 및 설정 완료.
